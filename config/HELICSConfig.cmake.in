# HELICS cmake module
# This module sets the following variables in your project::
#
#   HELICS_FOUND - true if HELICS found on the system
#   HELICS_INCLUDE_DIR - the directory containing HELICS headers
#   HELICS_C_SHARED_LIBRARY - the C shared library
# 	HELICS_CXX_SHARED_LIBRARY -the C++ shared library
#   HELICS_STATIC_LIBRARY -the static Library
# 	HELICS_DEPENDENCIES -- list of dependencies in the helics project
#   HELICS_PLAYER -- the player executable
#  	HELICS_RECORDER -- the recorder executable
#   HELICS_APP  -- the helics app executable
#   HELICS_BROKER -- the helics broker executable
@PACKAGE_INIT@

get_filename_component(HELICS_PREFIX_DIR "${CMAKE_CURRENT_LIST_FILE}" PATH)
get_filename_component(HELICS_PREFIX_DIR "${HELICS_PREFIX_DIR}" PATH)
get_filename_component(HELICS_PREFIX_DIR "${HELICS_PREFIX_DIR}" PATH)
get_filename_component(HELICS_PREFIX_DIR "${HELICS_PREFIX_DIR}" PATH)
if(HELICS_PREFIX_DIR STREQUAL "/")
  set(HELICS_PREFIX_DIR "")
endif()

message(status "HELICS PREFIX DIR = ${HELICS_PREFIX_DIR} ||")


set(PN HELICS)
set(${PN}_INCLUDE_DIR "${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_INCLUDEDIR@")

if (@BUILD_C_SHARED_LIB@)
set(${PN}_C_SHARED_LIBRARY "${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@/@helics_c_shared_file@")
set(${PN}_C_SHARED_LIBRARY_DEBUG "${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@/@helics_c_shared_file_debug@")
endif()

if (@BUILD_SHARED_LIBS@)
set(${PN}_CXX_SHARED_LIBRARY "${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@/@helics_cxx_shared_file@")
set(${PN}_CXX_SHARED_LIBRARY_DEBUG "${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@/@helics_cxx_shared_file_debug@")
endif()

set(${PN}_STATIC_LIBRARY "${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/@helics_static_file@")
set(${PN}_STATIC_LIBRARY_DEBUG "${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/@helics_static_file_debug@")

find_program(HELICS_PLAYER helics_player 
	PATH ${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@
	NO_DEFAULT_PATH)
	
find_program(HELICS_RECORDER helics_recorder 
	PATH ${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@
	NO_DEFAULT_PATH)
	
find_program(HELICS_APP helics_app 
	PATH ${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@
	NO_DEFAULT_PATH)
	
find_program(HELICS_BROKER helics_broker 
	PATH ${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_BINDIR@
	NO_DEFAULT_PATH)
	
set(SAVED_PARENT_CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH})
set(CMAKE_MODULE_PATH ${CMAKE_CURRENT_LIST_DIR})

include(CMakeFindDependencyMacro)

if (@ENABLE_ZMQ_CORE@)
	if (NOT @ZMQ_LOCAL_BUILD@)
		set(ZeroMQ_LIBRARY_ONLY ON)
		if(NOT ZeroMQ_INSTALL_PATH)
			if(ENV{ZeroMQ_INSTALL_PATH})
				set(ZeroMQ_INSTALL_PATH $ENV{ZeroMQ_INSTALL_PATH})
			endif()
		endif()
        # If ZeroMQ wasn't installed with this copy of HELICS, search for a system copy 
        if (NOT ZeroMQ_FOUND)
            unset(ZeroMQ_LIBRARY_PATH)
            find_dependency(ZeroMQ)
        endif()
	endif()
endif()

if (@ENABLE_MPI_CORE@)
	if (NOT TARGET MPI::MPI_C)
		include(${CMAKE_CURRENT_LIST_DIR}/addMPI.cmake)
	endif()
endif()

if (NOT TARGET Threads::Threads)
	if (NOT WIN32)
		set(THREADS_PREFER_PTHREAD_FLAG ON)
	elseif (MSYS)
		set(THREADS_PREFER_PTHREAD_FLAG ON)
	endif()
	find_dependency(Threads REQUIRED)
endif()

include(${CMAKE_CURRENT_LIST_DIR}/helics-targets.cmake)

if (@ENABLE_ZMQ_CORE@)
if (NOT TARGET @ZeroMQ_DEPENDENCY@ AND NOT TARGET HELICS::@ZeroMQ_DEPENDENCY@)

message(STATUS "checking for ${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/cmake/ZeroMQ/ZeroMQConfig.cmake")
	if (EXISTS ${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/cmake/ZeroMQ/ZeroMQConfig.cmake)
		include(${HELICS_PREFIX_DIR}/@CMAKE_INSTALL_LIBDIR@/cmake/ZeroMQ/ZeroMQConfig.cmake)
		message(STATUS "loading ZeroMQConfig")
	else()
	message(STATUS "finding ZMQ_PACKAGE")
	    unset(ZeroMQ_LIBRARY_ONLY)
		find_package(ZeroMQ)
	endif()
endif()
endif()

check_required_components(${PN})

set(CMAKE_MODULE_PATH ${SAVED_PARENT_CMAKE_MODULE_PATH})
