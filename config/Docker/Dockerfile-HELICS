FROM ubuntu:18.04 as builder

# Sets the number of threads for make to use
ARG MAKE_PARALLEL

RUN apt update && apt install -y \
  libboost-dev \
  libzmq5-dev \ 
  g++ \
  cmake git

WORKDIR /root/develop

RUN git clone https://github.com/GMLC-TDC/HELICS.git
RUN cd HELICS && mkdir build  && cd build && cmake -DBUILD_HELICS_TESTS=OFF -DENABLE_IPC_CORE=OFF -DBUILD_HELICS_EXAMPLES=OFF -DBUILD_C_SHARED_LIB=OFF \
  -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/root/develop/helics-install ..
RUN cd HELICS && cd build && make -j${MAKE_PARALLEL:-2} install
# Create script to build helics

RUN rm -rf /var/lib/apt/lists/* && rm -rf HELICS


# Final image with HELICS apps
FROM ubuntu:18.04
COPY --from=builder /root/develop/helics-install /usr
RUN apt-get update && apt-get install -y libzmq5 && apt-get clean
