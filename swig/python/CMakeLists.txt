
IF (GENERATE_PYTHON)

FIND_PACKAGE(PythonLibs REQUIRED)
INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_PATH})
INCLUDE_DIRECTORIES(${PYTHON_INCLUDE_DIRS})

SET(CMAKE_SWIG_FLAGS "")

SET_PROPERTY(SOURCE ../helics.i PROPERTY SWIG_MODULE_NAME helics)


IF (${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION} VERSION_GREATER 3.7)
  SWIG_ADD_LIBRARY(helics TYPE MODULE LANGUAGE python SOURCES ../helics.i)

  SWIG_LINK_LIBRARIES(helics helicsSharedLib)
  SWIG_LINK_LIBRARIES(helics ${PYTHON_LIBRARIES})

ELSE (${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION} VERSION_GREATER 3.7)
  SWIG_ADD_MODULE(helics python ../helics.i)

  SWIG_LINK_LIBRARIES(helics helicsSharedLib)
  SWIG_LINK_LIBRARIES(helics ${PYTHON_LIBRARIES})

ENDIF (${CMAKE_MAJOR_VERSION}.${CMAKE_MINOR_VERSION} VERSION_GREATER 3.7)

ELSE (GENERATE_PYTHON)


MESSAGE("Building without swig")

add_custom_target("helicsPYTHON" ALL)

configure_file(${CMAKE_CURRENT_SOURCE_DIR}/setup.py ${CMAKE_CURRENT_BINARY_DIR}/setup.py)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/helics_wrap.c ${CMAKE_CURRENT_BINARY_DIR}/helics_wrap.c)
configure_file(${CMAKE_CURRENT_SOURCE_DIR}/helics.py ${CMAKE_CURRENT_BINARY_DIR}/helics.py)

MESSAGE("CMAKE CURRENT" ${CMAKE_CURRENT_BINARY_DIR})
ADD_CUSTOM_TARGET("helicsPYTHONEXT" ALL DEPENDS helicsSharedLib helicsPYTHON)

ADD_CUSTOM_COMMAND(
    TARGET "helicsPYTHONEXT" POST_BUILD
    COMMAND "pip" #
    ARGS "install" "-e" "."
    WORKING_DIRECTORY "${CMAKE_CURRENT_BINARY_DIR}"
    COMMENT "Building Python extension"
)


ENDIF (GENERATE_PYTHON)