##############################################################################
#Copyright (C) 2017, Battelle Memorial Institute
#All rights reserved.

#This software was co-developed by Pacific Northwest National Laboratory, operated by the Battelle Memorial Institute; the National Renewable Energy Laboratory, operated by the Alliance for Sustainable Energy, LLC; and the Lawrence Livermore National Laboratory, operated by Lawrence Livermore National Security, LLC.
##############################################################################


set(application_api_test_headers
testFixtures.h
)

set(application_api_test_sources
test_configuration.h
value-converter-tests.cpp
application-api-tests.cpp
data-view-tests.cpp
testQueries.cpp
test-value-federate1.cpp
test-value-federate2.cpp
test-message-federate.cpp
test-filter-federate.cpp
federate_tests.cpp
heat-transfer-tests.cpp
timing_tests.cpp
iteration_tests.cpp
subPubObjectTests.cpp
testFixtures.cpp
)

include_directories( SYSTEM ${Boost_INCLUDE_DIR})
include_directories(SYSTEM ${PROJECT_SOURCE_DIR}/ThirdParty)
include_directories(${PROJECT_SOURCE_DIR}/src)

add_executable(application-api-tests ${application_api_test_sources} ${application_api_test_headers})
target_link_libraries(application-api-tests helics)

link_directories(${external_link_directories})



target_link_libraries(application-api-tests ${external_library_list})

target_link_libraries(application-api-tests ${Boost_LIBRARIES_test})

IF(MINGW)
	target_link_libraries(application-api-tests ws2_32)
ENDIF(MINGW)

ADD_DEFINITIONS(-DHELICS_BROKER_LOCATION="${HELICS_BROKER_LOC}")
ADD_DEFINITIONS(-DHELICS_INSTALL_LOCATION="${CMAKE_INSTALL_PREFIX}")

add_test(NAME application-api-tests COMMAND application-api-tests)

#-----------------------------------------------------------------------------
# Setup CTEST environment
#-----------------------------------------------------------------------------
include(CTest)

foreach(keyfile IN LISTS KEY_LIBRARY_FILES)
add_custom_command(TARGET application-api-tests POST_BUILD        # Adds a post-build event to api tests
    COMMAND ${CMAKE_COMMAND} -E copy_if_different  # which executes "cmake - E copy_if_different..."
        "${keyfile}"      # <--this is in-file
        "$<TARGET_FILE_DIR:application-api-tests>/")                 # <--this is out-file path
endforeach(keyfile)

